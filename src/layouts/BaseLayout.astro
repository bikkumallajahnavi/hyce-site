---
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import '../styles/global.css';

interface Props {
  title: string;
  description?: string;
}

const { title, description = 'HYCE Engineers & Infra â€“ 18+ years of excellence in civil engineering construction, external development, hardscape, landscape, and surveys.' } = Astro.props;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content={description} />
    <link rel="icon" type="image/png" href="/images/hyce-logo.png" />
    <title>{title} | HYCE Engineers & Infra</title>
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
  </head>
  <body>
    <!-- Page Loader -->
    <div class="page-loader" id="page-loader">
      <div class="loader-inner">
        <div class="loader-logo">
          <img src="/images/hyce-logo.png" alt="" width="80" height="80" />
        </div>
        <div class="loader-ring">
          <svg viewBox="0 0 100 100">
            <circle class="loader-track" cx="50" cy="50" r="42" />
            <circle class="loader-fill" cx="50" cy="50" r="42" />
          </svg>
        </div>
        <div class="loader-text">HYCE</div>
      </div>
    </div>

    <Header />
    <main>
      <slot />
    </main>
    <Footer />

    <style is:inline>
      .page-loader {
        position: fixed;
        inset: 0;
        z-index: 9999;
        background: #0a0e27;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: opacity 0.5s ease, visibility 0.5s ease;
      }

      .page-loader.hidden {
        opacity: 0;
        visibility: hidden;
        pointer-events: none;
      }

      .loader-inner {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0;
        position: relative;
      }

      .loader-logo {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -60%);
        z-index: 2;
        animation: loaderPulse 1.5s ease-in-out infinite;
      }

      .loader-logo img {
        width: 48px;
        height: auto;
        filter: drop-shadow(0 0 20px rgba(201, 168, 76, 0.3));
      }

      .loader-ring {
        width: 120px;
        height: 120px;
      }

      .loader-ring svg {
        width: 100%;
        height: 100%;
        transform: rotate(-90deg);
      }

      .loader-track {
        fill: none;
        stroke: rgba(255, 255, 255, 0.06);
        stroke-width: 3;
      }

      .loader-fill {
        fill: none;
        stroke: #c9a84c;
        stroke-width: 3;
        stroke-linecap: round;
        stroke-dasharray: 264;
        stroke-dashoffset: 264;
        animation: loaderSpin 1.4s ease-in-out infinite;
      }

      .loader-text {
        font-family: 'Playfair Display', Georgia, serif;
        font-size: 0.75rem;
        font-weight: 700;
        letter-spacing: 6px;
        color: rgba(201, 168, 76, 0.6);
        text-transform: uppercase;
        margin-top: 20px;
        animation: loaderFade 1.5s ease-in-out infinite;
      }

      @keyframes loaderSpin {
        0% { stroke-dashoffset: 264; }
        50% { stroke-dashoffset: 66; }
        100% { stroke-dashoffset: 264; }
      }

      @keyframes loaderPulse {
        0%, 100% { transform: translate(-50%, -60%) scale(1); opacity: 0.8; }
        50% { transform: translate(-50%, -60%) scale(1.08); opacity: 1; }
      }

      @keyframes loaderFade {
        0%, 100% { opacity: 0.4; }
        50% { opacity: 0.8; }
      }
    </style>

    <script is:inline>
      window.addEventListener('load', function() {
        var loader = document.getElementById('page-loader');
        if (loader) {
          setTimeout(function() {
            loader.classList.add('hidden');
          }, 600);
          setTimeout(function() {
            loader.style.display = 'none';
          }, 1100);
        }
      });
    </script>

    <script>
      if (window.netlifyIdentity) {
        window.netlifyIdentity.on("init", (user: any) => {
          if (!user) {
            window.netlifyIdentity.on("login", () => {
              document.location.href = "/admin/";
            });
          }
        });
      }
    </script>
  </body>
</html>
